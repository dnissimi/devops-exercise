sudo: required

services:
  - docker

env:
  global:
    - DOCKER_USER=dnissimi
#   - DOCKER_PASS=<secure: ...>
    - secure: "WHunPxgdCc0MkAcmJo+DZU3Za3tqtvSA2tLfJtUVeSzfw6UKcLjfdXCeSRtAH5ml+bzcIfDuYR0MlTpuR1UReRVNSk0q+lElN0qS654/9+6ST+9dJFIl+cSwzCdKa6tXESOWO0IinP/6mpJcx0tv3w1EMRPSSZToTa9qJKwCmQutaLUVahLIYopGaEei5Vcbh3pii/zfCN010dvBeH50YBCYVHnAAwGO/p2Jx/1gWEfDfYJ1rTwPjqpUfA+iVKcmg03MLyuXUdZmQKRdoMYUXwb3ZDBLc5BOziUrEP2SBdVi9yU91ZwiOA60FXqB1W9oAnV6pfI+eh1ECBaPvxq677SW9QkaB4THGxflQwPuOZt7WzzDwPfFcYg6dFP1s19gIiimHJ0gwr7FUAZcJgffa3vMQu1lEBoV3ZI66WzhoRA+BdwZrAOy+cTsnMDunKv+aWw8IxdXgd9fO8h5HwEiKoSdux/xRN/dpLTfI7CWjtgXfG3jA8PcNFixH/rfERRd2KL9/Kx38grLgjTrcOW7YWZIYkQjIKYWe87Mfl7InB0oa8lfzgFgdAPdJ9FC9DvSQ4JgC2XKHlW/oizDxsCj91VLwXHBwcTDYzxG/jbNRSd41QNrF7qQyCJd6cC7K8AvExXyB6hEfBguguz05LTZOa2dJnA5bV3OYae9/nmmHOs="


script:
  - docker build -t dnissimi/devops-exercise .
  - docker run -d dnissimi/devops-exercise

after_script:
  - docker images
  - coverage erase
  - coverage run test/test-http.py "http://127.0.0.1:8080/api/v1/about" && coverage html

after_success:
  - codecov

before_deploy:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS

deploy:
  provider: script
  script: docker push dnissimi/devops-exercise
  on:
    branch: master
