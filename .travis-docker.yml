sudo: required

language: python

python:
# - 2.7
# - 3.5
  - 3.6

services:
  - docker

env:
  global:
  - DOCKER_USER=dnissimi
#  - DOCKER_PASS=<secure: ...>
  - secure: "HsDkoNH8LGHyjucOUJy2lbQZ7x7TwWrAPysH2Y/2TzSlB6hWd0A89VZ3GrtRYLs0VE8KU//HtaSR7Wq8sEuweUochjncDq9HjLLKNbaxCprVmbxlkwM7BAZZguP1w7PmBfvKqdJ1DYyA6h/8gVL68dYk/NfNvdFwOZ+znvQay/u86IQ5kSk18xLtKI/pbO9tFSkI0IRgDNeBdCqcQTV0WIH+LrYJEmU3sv681e0v/YdkPQN2WSRZPNyHWLK0TNJp2QnoG2CdaJgWVWs5aSiW38jMOhnJ3RAXiFYlAuE2ajNv92BpNAGaoSxtJhZaVbgds11vV31X/8005Rkv76sG1NRPTybRxWhGmGv2R+3IrW/fw90Equ7nwLxpH1lI4k+K/xupf/DIQL2/VmSR6DzLKFHcfw035Pd06FO6r/HMuzVZTJTnYhXJh8ezbA+JxHivxgFJpVE5F97ldsbDzzxWipp1f821KgVD36PVAYa5IVV5zVdh9SpudrIyYir/yRJLRDyDcEei9DEzWYJL11jurZW0u/tFrnVqz+TwNULAspJqCR7UXKjQPzEGC6w2LD//IVjMVwoRM2rk24G/so4malSxSuIs7Yik51b16EkRf/2VDAjG5G87OR774Aw125E59JaMLanv4ffe7AbaKC45p+uq11Uj8SLpPgTpLx1KqB8="

install: 
  - pip install -r requirements/dev.txt

script:
  - docker build -t dnissimi/devops-exercise .
  - docker run -d -p 8080:8080 dnissimi/devops-exercise

#after_script:
  - docker images
  - docker ps
  - sleep 5
  - coverage erase
  - coverage run test/test-http.py "http://127.0.0.1:8080/api/v1.0/about" && coverage html

after_success:
  - codecov

before_deploy:
  - docker login -u "$DOCKER_USER" -p "$DOCKER_PASS"

deploy:
  provider: script
  script: docker push dnissimi/devops-exercise
  on:
    branch: master
